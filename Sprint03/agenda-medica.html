<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EasyClinic ‚Äî Agenda M√©dica</title>
<script>
  const usuarioLogado = localStorage.getItem("usuario_logado");
  if (!usuarioLogado) {
    window.location.href = "login.html";
  }
</script>

<style>
:root{
  --bg:#f6f8fb; --card:#ffffff; --muted:#69707a;
  --accent:#4f46e5; --accent-2:#06b6d4;
  --shadow:0 6px 18px rgba(16,24,40,0.08);
  --radius:12px; --max-width:1200px;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
}
*{box-sizing:border-box}
body,html{margin:0;background:var(--bg);height:100%}
.app{display:flex;min-height:100vh}

/* SIDEBAR */
.sidebar{
  width:260px;background:white;border-right:1px solid #e6eef6;
  padding:20px;display:flex;flex-direction:column;gap:14px;
  transition:.25s ease;
}
.sidebar.collapsed{width:72px;padding-left:10px;padding-right:10px}
.logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:white;font-weight:700;display:flex;align-items:center;justify-content:center}
.brand{display:flex;gap:12px;align-items:center;font-weight:700}
.titles{display:flex;flex-direction:column}
.small{font-size:12px;color:var(--muted)}
.nav{display:flex;flex-direction:column;gap:6px;margin-top:10px}
.nav a{
  display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;
  font-weight:600;text-decoration:none;color:#0f172a;
}
.nav a:hover{background:#f1f5f9}
.nav .active{
  background:linear-gradient(90deg,rgba(79,70,229,0.12),rgba(6,182,212,0.06));
  box-shadow:var(--shadow);
}
.sidebar.collapsed .titles,
.sidebar.collapsed .text,
.sidebar.collapsed .sidebar-footer{display:none}
.sidebar-footer{margin-top:auto;font-size:12px;color:var(--muted);text-align:center}

/* HEADER */
.main{flex:1;display:flex;flex-direction:column}
header{
  height:72px;display:flex;align-items:center;justify-content:space-between;
  padding:16px 28px;border-bottom:1px solid rgba(0,0,0,.05);position:relative;
}
.icon-btn{
  width:40px;height:40px;border-radius:10px;background:white;
  border:1px solid #e6eef6;display:flex;align-items:center;justify-content:center;
  cursor:pointer;font-size:18px;
}
.icon-btn:hover{background:#eef2ff}
.search input{
  padding:10px 12px;border-radius:10px;border:1px solid #e6eef6;
  background:white;min-width:260px;
}
.avatar{
  width:40px;height:40px;border-radius:999px;background:#c7d2fe;
  display:flex;align-items:center;justify-content:center;font-weight:700;color:#1e293b;cursor:pointer;
}

/* NOTIF POPUP - ESTILO RELATORIOS */
.notif-popup{
  position:absolute;top:74px;right:28px;width:300px;background:white;
  border-radius:12px;box-shadow:var(--shadow);padding:12px;display:none;z-index:50;
}
.notif-item{
  display:flex;justify-content:space-between;align-items:center;
  padding:8px;border:1px solid #eef3fb;background:white;
  margin-bottom:8px;border-radius:10px;
}
.meta{font-size:12px;color:var(--muted)}

/* CONTENT */
.content{padding:28px;max-width:var(--max-width);margin:0 auto}
.box{background:white;padding:18px;border-radius:12px;box-shadow:var(--shadow);}
table{width:100%;border-collapse:collapse;font-size:14px;margin-top:12px}
th,td{padding:12px;border:1px solid #eef3fb;text-align:center}
td select{
  padding:6px;border-radius:8px;border:1px solid #dce3ed;
}
.status-Livre{color:#16a34a;font-weight:700}
.status-Aguardando{color:#d97706;font-weight:700}
.status-Confirmado{color:#2563eb;font-weight:700}
.status-Finalizado{color:#6b7280;font-weight:700}
</style>
</head>

<body>

<div class="app">

<!-- SIDEBAR -->
<aside id="sidebar" class="sidebar">
  <div class="brand">
    <div class="logo">EC</div>
    <div class="titles"><div>EasyClinic</div><div class="small">Painel Administrativo</div></div>
  </div>

  <nav class="nav">
    <a href="index.html"><span>üè†</span><span class="text">In√≠cio</span></a>
    <a href="pacientes.html"><span>üò∑</span><span class="text">Pacientes</span></a>
    <a href="consultas.html"><span>üìã</span><span class="text">Consultas</span></a>
    <a class="active" href="agenda-medica.html"><span>üìÖ</span><span class="text">Agenda M√©dica</span></a>
    <a href="gerenciar-usuarios.html"><span>üë§</span><span class="text">Usu√°rios</span></a>
    <a href="relatorios.html"><span>üìä</span><span class="text">Relat√≥rios</span></a>
    <a href="configuracoes.html"><span>‚öôÔ∏è</span><span class="text">Configura√ß√µes</span></a>
  </nav>

  <div class="sidebar-footer">Vers√£o 1.0</div>
</aside>

<!-- MAIN -->
<div class="main">
<header>
  <div style="display:flex;align-items:center;gap:12px;">
    <div id="btnToggle" class="icon-btn">‚ò∞</div>
    <div class="search">
      <input id="buscaAgenda" placeholder="Buscar..." />
    </div>
  </div>

  <div style="display:flex;align-items:center;gap:16px;position:relative;">
    <div id="btnNotif" class="icon-btn">üîî</div>

    <!-- POPUP DE NOTIFICA√á√ïES - ESTILO RELATORIOS -->
    <div id="notifPopup" class="notif-popup">
      <h4>Notifica√ß√µes</h4>
      <div class="notif-item"><div><strong>Consulta hoje √†s 15h - confirmada</strong><div class="meta">agora</div></div><div class="meta">Recep√ß√£o</div></div>
      <div class="notif-item"><div><strong>Nova consulta agendada</strong><div class="meta">10:00h</div></div><div class="meta">Sistema</div></div>
      <div style="text-align:center;margin-top:8px"><button id="btnClearNotif" class="btn-ghost">Marcar todas como lidas</button></div>
    </div>

    <div style="text-align:right">
      <div style="font-size:13px;color:var(--muted)">Ol√°,</div>
      <div style="font-weight:700">Maria Silva</div>
    </div>

    <div id="avatar" class="avatar">MS</div>
  </div>
</header>

<main class="content">
  <h2>Agenda M√©dica ‚Äî Semana Atual</h2>

  <div style="margin:12px 0;">
    <label style="font-size:14px;color:var(--muted)">Filtrar por M√©dico:</label><br>
    <select id="filtroMedico" style="padding:8px;border-radius:10px;border:1px solid #dce3ed">
      <option value="">Todos</option>
    </select>
  </div>

  <div class="box">
    <table id="tabelaAgenda">
      <thead>
        <tr>
          <th>Hor√°rio</th>
          <th>Segunda</th>
          <th>Ter√ßa</th>
          <th>Quarta</th>
          <th>Quinta</th>
          <th>Sexta</th>
        </tr>
      </thead>
      <tbody id="agendaBody"></tbody>
    </table>
  </div>

</main>
</div>
</div>

<script>
btnToggle.onclick = () => sidebar.classList.toggle('collapsed');

btnNotif.onclick = e=>{
  e.stopPropagation();
  notifPopup.style.display = notifPopup.style.display === "block" ? "none" : "block";
};

btnClearNotif.addEventListener('click', ()=>{
  document.querySelectorAll('.notif-item').forEach(n => n.remove());
  const existe = notifPopup.querySelector('.empty-notif');
  if(!existe){
    const empty = document.createElement('div');
    empty.classList.add('empty-notif');
    empty.style.textAlign = 'center';
    empty.style.color = 'var(--muted)';
    empty.style.padding = '8px';
    empty.textContent = 'Nenhuma notifica√ß√£o.';
    notifPopup.insertBefore(empty, btnClearNotif.parentElement);
  }
});

document.addEventListener('click', e=>{
  if(!notifPopup.contains(e.target) && e.target !== btnNotif){
    notifPopup.style.display = "none";
  }
});

avatar.onclick = ()=>location.href="configuracoes.html";

/* ---- DADOS BASE ---- */
const medicos = ["Dr. Paulo","Dra. Ana","Dr. Ricardo"];
const especialidades = ["Cardiologia","Dermatologia","Ortopedia","Cl√≠nico Geral"];
const cpfs = ["123.456.789-00","987.654.321-10","555.444.333-22","111.222.333-44","222.333.444-55"];
const statusOpcoes = ["Livre","Aguardando","Confirmado","Finalizado"];
const horarios = ["08:00","09:00","10:00","11:00","13:00","14:00","15:00","16:00"];

function sorteia(lista){return lista[Math.floor(Math.random() * lista.length)];}

let agenda = {};

function gerarAgendaAleatoria(){
  horarios.forEach(h => {
    agenda[h] = [];
    for(let dia=0; dia<5; dia++){
      let chanceConsulta = dia === 2 ? 0.8 : 0.8;
      const temConsulta = Math.random() < chanceConsulta;
      if(temConsulta){
        agenda[h].push({
          paciente: sorteia(cpfs),
          esp: sorteia(especialidades),
          medico: sorteia(medicos),
          status: sorteia(["Aguardando","Confirmado","Finalizado"])
        });
      } else {
        agenda[h].push({ paciente: "Livre", esp: "-", medico: "-", status: "Livre" });
      }
    }
  });
  garantirMinimos();
}

function garantirMinimos(){
  for(let dia=0; dia<5; dia++){
    let existe = false;
    Object.keys(agenda).forEach(h=>{
      if(agenda[h][dia].status !== "Livre") existe = true;
    });
    if(!existe){
      const horarioAleatorio = sorteia(horarios);
      agenda[horarioAleatorio][dia] = {
        paciente: sorteia(cpfs),
        esp: sorteia(especialidades),
        medico: sorteia(medicos),
        status: sorteia(["Aguardando","Confirmado"])
      };
    }
  }
}

gerarAgendaAleatoria();

function renderAgenda(){
  const body = document.getElementById("agendaBody");
  body.innerHTML = "";
  Object.keys(agenda).forEach(h => {
    const tr = document.createElement("tr");
    let linha = `<td><strong>${h}</strong></td>`;
    for(let dia=0; dia<5; dia++){
      const slot = agenda[h][dia];
      const mostrar = !filtroMedico.value || filtroMedico.value === slot.medico || slot.status === "Livre";
      if(!mostrar){
        linha += `<td class="status-Livre">Livre</td>`;
        continue;
      }
      linha += `<td>
        <div><strong>${slot.paciente !== "Livre" ? slot.paciente : "Livre"}</strong></div>
        <div class="meta">${slot.medico !== "-" ? slot.medico : ""}</div>
        <div class="meta">${slot.esp !== "-" ? slot.esp : ""}</div>
        <select onchange="alterarStatus('${h}', ${dia}, this.value)" class="status-${slot.status}">
          ${statusOpcoes.map(s=>`<option value="${s}" ${s===slot.status?"selected":""}>${s}</option>`).join("")}
        </select>
      </td>`;
    }
    tr.innerHTML = linha;
    body.appendChild(tr);
  });
}

function alterarStatus(h,dia,novo){
  agenda[h][dia].status = novo;
  renderAgenda();
}

filtroMedico.onchange = renderAgenda;
buscaAgenda.oninput = e=>{
  const termo = e.target.value.toLowerCase();
  document.querySelectorAll("#agendaBody td").forEach(td=>{
    td.style.display = td.textContent.toLowerCase().includes(termo) ? "" : "none";
  });
};

renderAgenda();

/* LOGIN DIN√ÇMICO */
const user = JSON.parse(localStorage.getItem("usuario_logado"));
if (user) {
  document.querySelector("header div div[style*='font-weight']").textContent = user.nome;
  const iniciais = user.nome.split(" ").map(p=>p[0]).join("").toUpperCase();
  document.getElementById("avatar").textContent = iniciais;
}
</script>    
</body>
</html>
