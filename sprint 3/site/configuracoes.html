<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EasyClinic ‚Äî Configura√ß√µes</title>

<!-- BLOQUEIA SE N√ÉO ESTIVER LOGADO -->
<script>
const logado = localStorage.getItem('usuario_logado');
if (!logado) window.location.href = "login.html";
</script>

<style>
:root{
  --bg:#f6f8fb;--card:#ffffff;--muted:#69707a;--accent:#4f46e5;--accent-2:#06b6d4;
  --shadow:0 6px 18px rgba(16,24,40,0.08);--radius:12px;--max-width:1200px;
  font-family:Inter,system-ui;
}
*{box-sizing:border-box}
body,html{margin:0;height:100%;background:var(--bg)}

.app{display:flex;min-height:100vh;transform:none !important;zoom:1 !important;}
.main, .content {transform:none !important;zoom:1 !important;}
.sidebar {flex-shrink:0 !important;}

/* SIDEBAR */
.sidebar{
  width:260px;
  background:white;
  border-right:1px solid #e6eef6;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:14px;
  transition:.25s ease;
}
.sidebar.collapsed{
  width:72px;
  padding-left:10px;
  padding-right:10px;
}
.logo{
  width:44px;height:44px;border-radius:10px;
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  color:white;font-weight:700;display:flex;align-items:center;justify-content:center;
}
.brand{display:flex;gap:12px;align-items:center;font-weight:700}
.titles{display:flex;flex-direction:column}
.small{font-size:12px;color:var(--muted)}
.nav{display:flex;flex-direction:column;gap:6px;margin-top:10px;}
.nav a{
  display:flex;align-items:center;gap:12px;padding:10px;
  border-radius:10px;font-weight:600;text-decoration:none;color:#0f172a;
}
.nav a:hover{background:#f1f5f9}
.nav .active{background:linear-gradient(90deg,rgba(79,70,229,0.12),rgba(6,182,212,0.06));box-shadow:var(--shadow);}
.sidebar.collapsed .titles,.sidebar.collapsed .text,.sidebar.collapsed .sidebar-footer{display:none;}
.sidebar.collapsed .logo{margin:auto}
.sidebar-footer{margin-top:auto;font-size:12px;color:var(--muted);text-align:center;}

/* MAIN */
.main{flex:1;display:flex;flex-direction:column}

/* HEADER */
header{
  height:72px;display:flex;align-items:center;justify-content:space-between;
  padding:16px 28px;border-bottom:1px solid rgba(0,0,0,.05);position:relative;
}
.icon-btn{
  width:40px;height:40px;border-radius:10px;background:white;
  border:1px solid #e6eef6;display:flex;align-items:center;
  justify-content:center;cursor:pointer;font-size:18px;
}
.icon-btn:hover{background:#eef2ff}
.avatar{
  width:40px;height:40px;border-radius:999px;background:#c7d2fe;
  display:flex;align-items:center;justify-content:center;font-weight:700;color:#1e293b;cursor:pointer;
}
/* NOTIF POPUP */
.notif-popup{
  position:absolute;top:74px;right:28px;width:300px;background:white;
  border-radius:12px;box-shadow:var(--shadow);
  padding:12px;display:none;z-index:50;
}
.notif-item{
  display:flex;justify-content:space-between;align-items:center;
  padding:8px;border-radius:10px;margin-bottom:8px;
  border:1px solid #eef3fb;background:linear-gradient(180deg,#fff,#fbfdff);
}
.meta{font-size:12px;color:var(--muted)}

/* CONTENT */
.content{padding:28px;max-width:var(--max-width);margin:0 auto;width:100%}
.box{background:white;padding:18px;border-radius:12px;box-shadow:var(--shadow);margin-bottom:22px;}
label{font-size:13px;color:var(--muted)}
input,select{padding:10px;border-radius:10px;border:1px solid #d7e0ec;width:100%;}
.btn{padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:700;cursor:pointer;margin-top:16px}
.feedback{font-size:13px;color:green;margin-top:6px;display:none;}
.logout-btn{padding:10px 14px;border-radius:10px;background:#fee2e2;color:#991b1b;font-weight:700;border:0;cursor:pointer;}
.logout-btn:hover{background:#fca5a5}
</style>
</head>

<body>
<div class="app">

<!-- SIDEBAR -->
<aside id="sidebar" class="sidebar">
  <div class="brand">
    <div class="logo">EC</div>
    <div class="titles">
      <div>EasyClinic</div>
      <div class="small">Painel Administrativo</div>
    </div>
  </div>

  <nav class="nav">
    <a href="index.html"><span class="icon">üè†</span><span class="text">In√≠cio</span></a>
    <a href="pacientes.html"><span class="icon">üò∑</span><span class="text">Pacientes</span></a>
    <a href="consultas.html"><span class="icon">üìã</span><span class="text">Consultas</span></a>
    <a href="agenda-medica.html"><span class="icon">üìÖ</span><span class="text">Agenda M√©dica</span></a>
    <a href="gerenciar-usuarios.html"><span class="icon">üë§</span><span class="text">Usu√°rios</span></a>
    <a href="relatorios.html"><span class="icon">üìä</span><span class="text">Relat√≥rios</span></a>
    <a href="configuracoes.html" class="active"><span class="icon">‚öôÔ∏è</span><span class="text">Configura√ß√µes</span></a>
  </nav>

  <div class="sidebar-footer">Vers√£o 1.0</div>
</aside>

<!-- MAIN -->
<div class="main">

<header>
  <div style="display:flex;align-items:center;gap:12px;">
    <div id="btnToggle" class="icon-btn">‚ò∞</div>
  </div>

  <div style="display:flex;align-items:center;gap:16px;position:relative;">
    <div id="btnNotif" class="icon-btn">üîî</div>
    <div id="notifPopup" class="notif-popup">
      <h4>Notifica√ß√µes</h4>
      <div class="notif-item"><div><strong>Senha alterada</strong><div class="meta">agora</div></div><div class="meta">Admin</div></div>
      <div class="notif-item"><div><strong>Prefer√™ncias atualizadas</strong><div class="meta">1 min atr√°s</div></div><div class="meta">Admin</div></div>
      <div style="text-align:center;margin-top:8px"><button id="btnClearNotif" class="btn-ghost">Marcar todas como lidas</button></div>
    </div>

    <div style="text-align:right">
      <div style="font-size:13px;color:var(--muted)">Ol√°,</div>
      <div id="headerNome" style="font-weight:700">Usu√°rio</div>
    </div>

    <div id="avatar" class="avatar">U</div>
  </div>
</header>

<main class="content">

<h2>Configura√ß√µes</h2>

<!-- DADOS DA CONTA -->
<div class="box">
  <h3>Dados da Conta</h3>

  <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px">
    <div>
      <label>Nome</label>
      <input id="cfgNome" disabled>
    </div>

    <div>
      <label>E-mail</label>
      <input id="cfgEmail" type="email" disabled>
    </div>

    <div>
      <label>CPF</label>
      <input id="cfgCPF" maxlength="14" disabled>
    </div>

    <div>
      <label>Fun√ß√£o / Cargo</label>
      <input id="cfgCargo" disabled>
    </div>
  </div>
</div>

<!-- ALTERAR SENHA -->
<div class="box">
  <h3>Alterar Senha</h3>

  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px">
    <div>
      <label>Senha atual</label>
      <input id="sAtual" type="password">
    </div>
    <div>
      <label>Nova senha</label>
      <input id="sNova" type="password">
    </div>
    <div>
      <label>Confirmar nova</label>
      <input id="sConf" type="password">
    </div>
  </div>

  <button id="btnSalvarSenha" class="btn">Salvar Senha</button>
  <div id="fbSenha" class="feedback">Senha alterada com sucesso.</div>
</div>

<!-- PREFER√äNCIAS -->
<div class="box">
  <h3>Prefer√™ncias</h3>

  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:12px">
    <div>
      <label>Tema</label>
      <select id="cfgTema">
        <option value="claro">Claro</option>
        <option value="escuro">Escuro</option>
      </select>
    </div>

    <div>
      <label>Notifica√ß√µes</label>
      <select id="cfgNotif">
        <option value="todas">Todas</option>
        <option value="importantes">Importantes</option>
        <option value="nenhuma">Nenhuma</option>
      </select>
    </div>

    <div>
      <label>Densidade</label>
      <select id="cfgDense">
        <option value="normal">Normal</option>
        <option value="compacta">Compacta</option>
        <option value="ampla">Ampla</option>
      </select>
    </div>
  </div>

  <button id="btnSalvarPref" class="btn">Salvar Prefer√™ncias</button>
  <div id="fbPref" class="feedback">Prefer√™ncias atualizadas.</div>
</div>

<!-- LOGOUT -->
<div class="box" style="text-align:center">
  <button class="logout-btn" id="btnLogout">Sair da Conta</button>
</div>

</main>
</div>
</div>

<script>
/* -------------------- helpers DB -------------------- */
function getUsuariosDB(){
  return JSON.parse(localStorage.getItem('db_usuarios') || "[]");
}
function saveUsuariosDB(db){
  localStorage.setItem('db_usuarios', JSON.stringify(db));
}

/* Inicializa db se necess√°rio */
(function initDB(){
  const db = localStorage.getItem('db_usuarios');
  if(!db){
    const adminDefault = [
      {nome:"Administrador", email:"admin@admin.com", cpf:"000.000.000-00", senha:"123", tipo:"Administrador", status:"Ativo"}
    ];
    localStorage.setItem('db_usuarios', JSON.stringify(adminDefault));
  }
})();

/* -------------------- UI refs -------------------- */
const btnToggle = document.getElementById('btnToggle');
const sidebar = document.getElementById('sidebar');
const btnNotif = document.getElementById('btnNotif');
const notifPopup = document.getElementById('notifPopup');
const avatar = document.getElementById('avatar');
const headerNome = document.getElementById('headerNome');

const cfgNome = document.getElementById('cfgNome');
const cfgEmail = document.getElementById('cfgEmail');
const cfgCPF = document.getElementById('cfgCPF');
const cfgCargo = document.getElementById('cfgCargo');

const sAtual = document.getElementById('sAtual');
const sNova = document.getElementById('sNova');
const sConf = document.getElementById('sConf');
const btnSalvarSenha = document.getElementById('btnSalvarSenha');
const fbSenha = document.getElementById('fbSenha');

const cfgTema = document.getElementById('cfgTema');
const cfgNotif = document.getElementById('cfgNotif');
const cfgDense = document.getElementById('cfgDense');
const btnSalvarPref = document.getElementById('btnSalvarPref');
const fbPref = document.getElementById('fbPref');

const btnLogout = document.getElementById('btnLogout');

/* -------------------- Intera√ß√µes b√°sicas -------------------- */
btnToggle.onclick = ()=> sidebar.classList.toggle("collapsed");

btnNotif.onclick = e=>{
  e.stopPropagation();
  notifPopup.style.display = notifPopup.style.display==="block" ? "none" : "block";
};
document.addEventListener("click", e=>{
  if(!notifPopup.contains(e.target) && e.target!==btnNotif){
    notifPopup.style.display="none";
  }
});
avatar.onclick = ()=>location.href="configuracoes.html";

/* -------------------- carregar dados do usu√°rio logado -------------------- */
function carregarUsuarioLogado(){
  const user = JSON.parse(localStorage.getItem('usuario_logado') || "null");
  if(!user) return;

  cfgNome.value = user.nome || "";
  cfgEmail.value = user.email || "";
  cfgCPF.value = user.cpf || "";
  cfgCargo.value = user.tipo || "";
  headerNome.textContent = user.nome;

  // avatar iniciais
  const iniciais = (user.nome||"").split(" ").map(p=>p[0]||"").join("").substring(0,2).toUpperCase();
  avatar.textContent = iniciais || "U";

  // preencher prefer√™ncias caso existam
  const prefs = JSON.parse(localStorage.getItem('prefs_' + user.email) || "null");
  if(prefs){
    if(prefs.tema) cfgTema.value = prefs.tema;
    if(prefs.notif) cfgNotif.value = prefs.notif;
    if(prefs.dense) cfgDense.value = prefs.dense;
  }
}
carregarUsuarioLogado();

/* -------------------- alterar senha -------------------- */
btnSalvarSenha.onclick = ()=>{
  const atual = sAtual.value.trim();
  const nova = sNova.value.trim();
  const conf = sConf.value.trim();
  if(!atual || !nova || !conf){
    alert("Preencha todos os campos.");
    return;
  }
  if(nova !== conf){
    alert("As senhas n√£o coincidem.");
    return;
  }
  if(nova.length < 3){
    alert("A nova senha deve ter ao menos 3 caracteres.");
    return;
  }

  const user = JSON.parse(localStorage.getItem('usuario_logado') || "null");
  if(!user){
    alert("Usu√°rio n√£o encontrado.");
    return;
  }
  if(atual !== user.senha){
    alert("Senha atual incorreta.");
    return;
  }

  const db = getUsuariosDB();
  const idx = db.findIndex(u => u.email === user.email);
  if(idx!==-1) db[idx].senha = nova;
  saveUsuariosDB(db);

  user.senha = nova;
  localStorage.setItem('usuario_logado', JSON.stringify(user));

  fbSenha.style.display="block";
  setTimeout(()=> fbSenha.style.display="none",2500);

  sAtual.value=""; sNova.value=""; sConf.value="";
  notifPopup.style.display="block";
};

/* -------------------- salvar prefer√™ncias -------------------- */
btnSalvarPref.onclick = ()=>{
  const user = JSON.parse(localStorage.getItem('usuario_logado') || "null");
  if(!user) return;
  const prefs = {tema: cfgTema.value, notif: cfgNotif.value, dense: cfgDense.value};
  localStorage.setItem('prefs_' + user.email, JSON.stringify(prefs));
  fbPref.style.display="block";
  setTimeout(()=> fbPref.style.display="none",2500);
};
btnClearNotif.addEventListener('click', ()=>{
  // remove todos os itens existentes
  document.querySelectorAll('.notif-item').forEach(n => n.remove());

  // verifica se j√° existe a mensagem "Nenhuma notifica√ß√£o"
  const existe = notifPopup.querySelector('.empty-notif');
  if(!existe){
    const empty = document.createElement('div');
    empty.classList.add('empty-notif'); // adiciona classe para controle
    empty.style.textAlign = 'center';
    empty.style.color = 'var(--muted)';
    empty.style.padding = '8px';
    empty.textContent = 'Nenhuma notifica√ß√£o.';
    notifPopup.insertBefore(empty, btnClearNotif.parentElement);
  }
});

/* -------------------- logout -------------------- */
btnLogout.onclick = ()=>{
  if(confirm("Deseja realmente sair do sistema?")){
    localStorage.removeItem('usuario_logado');
    location.href="login.html";
  }
};
</script>

</body>
</html>