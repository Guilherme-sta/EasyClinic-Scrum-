<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EasyClinic ‚Äî Consultas</title>
<script>
  const usuarioLogado = localStorage.getItem("usuario_logado");
  if (!usuarioLogado) {
    window.location.href = "login.html";
  }
</script>

<style>
:root{
  --bg:#f6f8fb; --card:#ffffff; --muted:#69707a;
  --accent:#4f46e5; --accent-2:#06b6d4;
  --shadow:0 6px 18px rgba(16,24,40,0.08);
  --radius:12px; --max-width:1200px;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
}
*{box-sizing:border-box}
body,html{margin:0;background:var(--bg);height:100%}
.app{display:flex;min-height:100vh}

/* SIDEBAR */
.sidebar{
  width:260px;background:white;border-right:1px solid #e6eef6;
  padding:20px;display:flex;flex-direction:column;gap:14px;
  transition:.25s ease;
}
.sidebar.collapsed{width:72px;padding-left:10px;padding-right:10px}
.logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:white;font-weight:700;display:flex;align-items:center;justify-content:center}
.brand{display:flex;gap:12px;align-items:center;font-weight:700}
.titles{display:flex;flex-direction:column}
.small{font-size:12px;color:var(--muted)}
.nav{display:flex;flex-direction:column;gap:6px;margin-top:10px}
.nav a{
  display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;
  font-weight:600;text-decoration:none;color:#0f172a;
}
.nav a:hover{background:#f1f5f9}
.nav .active{
  background:linear-gradient(90deg,rgba(79,70,229,0.12),rgba(6,182,212,0.06));
  box-shadow:var(--shadow);
}
.sidebar.collapsed .titles,
.sidebar.collapsed .text,
.sidebar.collapsed .sidebar-footer{display:none}
.sidebar-footer{margin-top:auto;font-size:12px;color:var(--muted);text-align:center}

/* HEADER */
.main{flex:1;display:flex;flex-direction:column}
header{
  height:72px;display:flex;align-items:center;justify-content:space-between;
  padding:16px 28px;border-bottom:1px solid rgba(0,0,0,.05);position:relative;
}
.icon-btn{
  width:40px;height:40px;border-radius:10px;background:white;
  border:1px solid #e6eef6;display:flex;align-items:center;justify-content:center;
  cursor:pointer;font-size:18px;
}
.icon-btn:hover{background:#eef2ff}
.search input{
  padding:10px 12px;border-radius:10px;border:1px solid #e6eef6;
  background:white;min-width:260px;
}
.avatar{
  width:40px;height:40px;border-radius:999px;background:#c7d2fe;
  display:flex;align-items:center;justify-content:center;font-weight:700;color:#1e293b;cursor:pointer;
}

/* NOTIF POPUP */
.notif-popup{
  position:absolute;top:74px;right:28px;width:300px;background:white;
  border-radius:12px;box-shadow:var(--shadow);padding:12px;display:none;z-index:50;
}
.notif-item{
  display:flex;justify-content:space-between;align-items:center;
  padding:8px;border:1px solid #eef3fb;background:#ffffff;margin-bottom:8px;border-radius:10px;
}
.meta{font-size:12px;color:var(--muted)}

/* CONTENT */
.content{padding:28px;max-width:var(--max-width);margin:0 auto}

/* TABLE */
.box{
  background:white;padding:18px;border-radius:12px;box-shadow:var(--shadow);
}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px}
th,td{padding:12px;border-bottom:1px solid #eef3fb;text-align:left}

.btn-add{
  padding:10px 14px;border-radius:10px;border:0;background:var(--accent);
  color:white;font-weight:700;cursor:pointer
}

/* FORM PANEL */
.panel{
  width:420px;height:100vh;background:white;position:fixed;top:0;right:-420px;
  box-shadow:-4px 0 14px rgba(0,0,0,.08);
  transition:.3s;padding:24px;overflow-y:auto;z-index:90;
}
.panel.open{right:0}
.panel label{font-size:13px;color:var(--muted)}
.panel input, .panel select{
  width:100%;padding:10px;border:1px solid #dce3ed;border-radius:10px;margin-bottom:12px;
}
.save-btn{
  width:100%;padding:10px;background:var(--accent);border:0;border-radius:10px;
  color:white;font-weight:700;margin-top:10px;cursor:pointer
}
.cancel-btn{
  width:100%;padding:10px;background:white;border:1px solid #dce3ed;
  border-radius:10px;color:#1e293b;font-weight:600;margin-top:6px;cursor:pointer
}
</style>
</head>

<body>

<div class="app">

<!-- SIDEBAR -->
<aside id="sidebar" class="sidebar">
  <div class="brand">
    <div class="logo">EC</div>
    <div class="titles"><div>EasyClinic</div><div class="small">Painel Administrativo</div></div>
  </div>

  <nav class="nav">
    <a href="index.html"><span class="icon">üè†</span><span class="text">In√≠cio</span></a>
    <a href="pacientes.html"><span class="icon">üò∑</span><span class="text">Pacientes</span></a>
    <a class="active" href="consultas.html"><span class="icon">üìã</span><span class="text">Consultas</span></a>
    <a href="agenda-medica.html"><span class="icon">üìÖ</span><span class="text">Agenda M√©dica</span></a>
    <a href="gerenciar-usuarios.html"><span class="icon">üë§</span><span class="text">Usu√°rios</span></a>
    <a href="relatorios.html"><span class="icon">üìä</span><span class="text">Relat√≥rios</span></a>
    <a href="configuracoes.html"><span class="icon">‚öôÔ∏è</span><span class="text">Configura√ß√µes</span></a>
  </nav>

  <div class="sidebar-footer">Vers√£o 1.0</div>
</aside>

<!-- MAIN -->
<div class="main">
<header>
  <div style="display:flex;align-items:center;gap:12px;">
    <div id="btnToggle" class="icon-btn">‚ò∞</div>
    <div class="search"><input id="searchCons" placeholder="Buscar consultas..." /></div>
  </div>

  <div style="display:flex;align-items:center;gap:16px;position:relative;">
    <div id="btnNotif" class="icon-btn">üîî</div>

    <div id="notifPopup" class="notif-popup">
      <h4>Notifica√ß√µes</h4>
      <div class="notif-item"><div><strong>Consulta marcada</strong><div class="meta">10:00h</div></div><div class="meta">Recep√ß√£o</div></div>
      <div style="text-align:center;margin-top:8px"><button id="btnClearNotif" class="btn-ghost">Marcar todas como lidas</button></div>
    </div>

    <div style="text-align:right">
      <div style="font-size:13px;color:var(--muted)">Ol√°,</div>
      <div style="font-weight:700">Maria Silva</div>
    </div>

    <div id="avatar" class="avatar">MS</div>
  </div>
</header>

<main class="content">
  <h2>Consultas</h2>

  <button id="btnNovo" class="btn-add">+ Nova Consulta</button>

  <div class="box" style="margin-top:18px;">
    <table>
      <thead>
        <tr>
          <th>CPF do Paciente</th>
          <th>M√©dico</th>
          <th>Especialidade</th>
          <th>Data</th>
          <th>Hora</th>
        </tr>
      </thead>
      <tbody id="listaConsultas"></tbody>
    </table>
  </div>
</main>
</div>
</div>

<!-- PANEL -->
<div id="panel" class="panel">
  <h2 id="formTitulo">Nova Consulta</h2>

  <label>Paciente (CPF)</label>
  <select id="cPac"></select>

  <label>M√©dico</label>
  <select id="cMed"></select>

  <label>Especialidade</label>
  <select id="cEsp"></select>

  <label>Data</label>
  <input type="date" id="cData" />

  <label>Hora</label>
  <input type="time" id="cHora" />

  <button id="btnSalvar" class="save-btn">Salvar</button>
  <button id="btnCancelar" class="cancel-btn">Cancelar</button>
</div>

<script>
/* SIDEBAR */
btnToggle.onclick = () => sidebar.classList.toggle('collapsed');

/* NOTIF */
btnNotif.onclick = e=>{
  e.stopPropagation();
  notifPopup.style.display = notifPopup.style.display === "block" ? "none" : "block";
};

btnClearNotif.addEventListener('click', ()=>{
  // remove todos os itens existentes
  document.querySelectorAll('.notif-item').forEach(n => n.remove());

  // verifica se j√° existe a mensagem "Nenhuma notifica√ß√£o"
  const existe = notifPopup.querySelector('.empty-notif');
  if(!existe){
    const empty = document.createElement('div');
    empty.classList.add('empty-notif'); // adiciona classe para controle
    empty.style.textAlign = 'center';
    empty.style.color = 'var(--muted)';
    empty.style.padding = '8px';
    empty.textContent = 'Nenhuma notifica√ß√£o.';
    notifPopup.insertBefore(empty, btnClearNotif.parentElement);
  }
});
document.addEventListener('click', e=>{
  if(!notifPopup.contains(e.target) && e.target !== btnNotif)
    notifPopup.style.display = "none";
});
avatar.onclick = ()=>location.href="configuracoes.html";

/* PANEL */
const panel = document.getElementById('panel');
btnNovo.onclick = ()=>{
  editIndex = null;
  formTitulo.textContent = "Nova Consulta";

  cPac.value = "";
  cMed.value="";
  cEsp.value="";
  cData.value = "";
  cHora.value = "";

  panel.classList.add("open");
};
btnCancelar.onclick = ()=> panel.classList.remove("open");

/* DADOS FAKE */
const medicos = ["Dr. Paulo","Dra. Ana","Dr. Ricardo","Dra. Marina","Dr. Lucas"];
const especialidades = ["Cardiologia","Dermatologia","Pediatria","Ortopedia","Cl√≠nico Geral"];
const cpfsPacientes = [
  "123.456.789-00",
  "987.654.321-10",
  "555.444.333-22",
  "111.222.333-44",
  "000.111.222-33"
];

medicos.forEach(m=>{ const o=document.createElement("option"); o.textContent=m; cMed.appendChild(o); });
especialidades.forEach(e=>{ const o=document.createElement("option"); o.textContent=e; cEsp.appendChild(o); });
cpfsPacientes.forEach(cpf=>{
  const o = document.createElement("option");
  o.textContent = cpf;
  cPac.appendChild(o);
});

/* CONSULTAS STORAGE */
function getConsultas(){
  return JSON.parse(localStorage.getItem("consultas") || "[]");
}
function saveConsultas(d){
  localStorage.setItem("consultas", JSON.stringify(d));
}

let editIndex = null;

/* RENDER CONSULTAS */
function renderConsultas(){
  const tb = document.getElementById("listaConsultas");
  tb.innerHTML = "";
  getConsultas().forEach((c,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.paciente}</td>
      <td>${c.medico}</td>
      <td>${c.esp}</td>
      <td>${c.data}</td>
      <td>${c.hora}</td>
    `;
    tb.appendChild(tr);
  });
}
renderConsultas();

/* SALVAR */
btnSalvar.onclick = ()=>{
  const paciente = cPac.value;
  const medico   = cMed.value;
  const esp      = cEsp.value;
  const data     = cData.value;
  const hora     = cHora.value;

  if(!paciente||!medico||!esp||!data||!hora){
    alert("Preencha todos os campos.");
    return;
  }

  const arr = getConsultas();

  if(editIndex===null){
    arr.push({paciente,medico,esp,data,hora});
  } else {
    arr[editIndex] = {paciente,medico,esp,data,hora};
  }

  saveConsultas(arr);
  renderConsultas();
  panel.classList.remove("open");
};

/* SEARCH */
searchCons.oninput = (e)=>{
  const v = e.target.value.toLowerCase();
  document.querySelectorAll("#listaConsultas tr").forEach(tr=>{
    tr.style.display = tr.textContent.toLowerCase().includes(v) ? "" : "none";
  });
};

/* LOGIN ‚Äî NOME E AVATAR DIN√ÇMICOS */
const user = JSON.parse(localStorage.getItem("usuario_logado"));

if (user) {
  // Nome do usu√°rio no header
  document.querySelector("header div div[style*='font-weight']").textContent =
    user.nome;

  // Avatar com iniciais
  const iniciais = user.nome
    .split(" ")
    .map(p => p[0])
    .join("")
    .toUpperCase();

  document.getElementById("avatar").textContent = iniciais;
}
</script>
</body>
</html>